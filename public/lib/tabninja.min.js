/*!
 * TabNinja JavaScript Library v0.0.1
 * https://github.com/studentIvan/tabninja
 *
 * Copyright 2015 Maslov Ivan
 * Released under the MIT license
 * https://raw.githubusercontent.com/studentIvan/tabninja/master/LICENSE
 */

duel.tabNinja={},duel.tabNinja.localStorageAvailable=duel.isLocalStorageAvailable(),duel.tabNinja.ninjaName=-1,duel.tabNinja.localStorageAvailable&&(sessionStorage.getItem("tabninja:here")||(sessionStorage.setItem("tabninja:here","yes"),localStorage.setItem("tabninja:stack",""))),duel.tabNinja.isSuperMaster=function(){if(!duel.tabNinja.localStorageAvailable)return!0;try{var a=JSON.parse(localStorage.getItem("tabninja:stack"));return-1===duel.tabNinja.ninjaName&&(duel.tabNinja.ninjaName=+Math.max.apply(0,a)+1),-1===a.indexOf(duel.tabNinja.ninjaName)?(a.push(duel.tabNinja.ninjaName),localStorage.setItem("tabninja:stack",JSON.stringify(a)),!1):0===a.indexOf(duel.tabNinja.ninjaName)}catch(e){return duel.tabNinja.ninjaName=1,localStorage.setItem("tabninja:stack","[1]"),!0}},duel.tabNinja.killCurrentNinja=function(){localStorage.setItem("tabninja:unloaded",1);try{var a=JSON.parse(localStorage.getItem("tabninja:stack"));a.splice(a.indexOf(duel.tabNinja.ninjaName),1),a.length>0?localStorage.setItem("tabninja:stack",JSON.stringify(a)):localStorage.setItem("tabninja:stack","")}catch(e){localStorage.setItem("tabninja:stack","")}},duel.tabNinja.isSuperMaster(),window.isSuperMaster=duel.tabNinja.isSuperMaster,duel.addEvent(window,"unload",duel.tabNinja.killCurrentNinja);